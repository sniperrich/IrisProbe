version: '3.9'

services:
  control-plane:
    build:
      context: ..
      dockerfile: remote/Dockerfile
    container_name: nebula-control-plane
    environment:
      NODE_API_HOST: 0.0.0.0
      NODE_API_PORT: 5050
    ports:
      - '5050:5050'
    restart: unless-stopped

  probe-local:
    build:
      context: ..
      dockerfile: remote/Dockerfile
    container_name: nebula-probe-local
    command: ['node', 'probe/agent.js']
    environment:
      PROBE_ENDPOINT: http://control-plane:5050/api/telemetry
      PROBE_NODE_ID: docker-node
      PROBE_REGION: docker-edge
      PROBE_ROLE: monitor
      PROBE_PUSH_INTERVAL_MS: 7000
      PROBE_BATCH_SIZE: 5
    depends_on:
      - control-plane
    restart: unless-stopped
